# .zshrc - Modular zsh configuration

#######################################################################################################################
# Powerlevel10k instant prompt (must stay at top)
#######################################################################################################################

if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

#######################################################################################################################
# Load conf.d modules (in numeric order)
#######################################################################################################################

for conf in ~/.config/zsh/conf.d/[0-9]*.zsh(N); do
  source "$conf"
done

#######################################################################################################################
# Keybindings
#######################################################################################################################

bindkey -e

#######################################################################################################################
# Auto-start tmux
#######################################################################################################################

# Skip tmux if:
#   - NOTMUX=1 is set (escape hatch)
#   - Already inside tmux
#   - Not an interactive shell
#   - Inside VS Code integrated terminal
#   - Running in a script/non-terminal context
if [[ -z "$NOTMUX" && -z "$TMUX" && $- == *i* && -z "$VSCODE_TERMINAL" && -t 0 ]]; then
  exec tmux new-session -A -s main
fi
